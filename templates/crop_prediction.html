{% extends "base.html" %}
{% block title %}Crop Prediction – AgroMate{% endblock %}

{% block content %}

<!-- Page Hero -->
<section class="page-hero">
  <div class="page-hero-overlay"></div>
  <div class="container text-center">
    <span class="section-tag-light" data-aos="fade-up">ML TOOL — 01</span>
    <h1 class="page-hero-title" data-aos="fade-up" data-aos-delay="100">Crop Prediction</h1>
    <p class="page-hero-subtitle" data-aos="fade-up" data-aos-delay="200">
      Tell us about your soil and climate — we'll tell you what to grow.
    </p>
    <nav aria-label="breadcrumb" data-aos="fade-up" data-aos-delay="300">
      <ol class="breadcrumb justify-content-center">
        <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
        <li class="breadcrumb-item active">Crop Prediction</li>
      </ol>
    </nav>
  </div>
</section>

<!-- Main Content -->
<section class="section-padding">
  <div class="container">
    <div class="row justify-content-center gy-5">

      <!-- Form card -->
      <div class="col-lg-7">
        <div class="tool-card" data-aos="fade-up">
          <div class="tool-card-header">
            <div class="tool-icon crop"><i class="bi bi-seedling"></i></div>
            <div>
              <h4 class="mb-0">Enter Soil &amp; Climate Details</h4>
              <p class="text-muted small mb-0">All fields are required for accurate prediction</p>
            </div>
          </div>

          <form method="POST" action="{{ url_for('crop_prediction') }}" class="mt-4" id="cropForm">
            <div class="row g-3">
              <!-- Nitrogen -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-circle-fill text-success me-2 small"></i>Nitrogen (N) — kg/ha
                </label>
                <input type="number" step="0.1" min="0" max="200" name="nitrogen"
                       class="form-control" placeholder="e.g. 90" required />
              </div>
              <!-- Phosphorus -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-circle-fill text-warning me-2 small"></i>Phosphorus (P) — kg/ha
                </label>
                <input type="number" step="0.1" min="0" max="200" name="phosphorus"
                       class="form-control" placeholder="e.g. 42" required />
              </div>
              <!-- Potassium -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-circle-fill text-danger me-2 small"></i>Potassium (K) — kg/ha
                </label>
                <input type="number" step="0.1" min="0" max="200" name="potassium"
                       class="form-control" placeholder="e.g. 43" required />
              </div>
              <!-- Temperature -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-thermometer-half text-orange me-2"></i>Temperature — °C
                </label>
                <input type="number" step="0.1" min="-10" max="60" name="temperature"
                       class="form-control" placeholder="e.g. 25" required />
              </div>
              <!-- Humidity -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-droplet-half text-info me-2"></i>Humidity — %
                </label>
                <input type="number" step="0.1" min="0" max="100" name="humidity"
                       class="form-control" placeholder="e.g. 80" required />
              </div>
              <!-- pH -->
              <div class="col-md-6">
                <label class="form-label fw-semibold">
                  <i class="bi bi-activity text-purple me-2"></i>Soil pH
                </label>
                <input type="number" step="0.1" min="0" max="14" name="ph"
                       class="form-control" placeholder="e.g. 6.5" required />
              </div>
              <!-- Rainfall -->
              <div class="col-md-12">
                <label class="form-label fw-semibold">
                  <i class="bi bi-cloud-rain-fill text-primary me-2"></i>Rainfall — mm
                </label>
                <input type="number" step="0.1" min="0" max="4000" name="rainfall"
                       class="form-control" placeholder="e.g. 202" required />
              </div>
            </div>

            <button type="submit" class="btn btn-green w-100 mt-4 py-3 fs-5 fw-semibold" id="predictBtn">
              <i class="bi bi-cpu me-2"></i>Predict Best Crop
            </button>
          </form>

          <!-- Result -->
          {% if result %}
          <div class="result-box mt-4" data-aos="zoom-in">
            <div class="result-icon"><i class="bi bi-patch-check-fill"></i></div>
            <div class="w-100">
              <p class="result-label">Recommended Crop</p>
              <h3 class="result-value">{{ result.crop }}</h3>
              <p class="result-hint text-muted small mb-2">
                Based on your soil and climate data, <strong>{{ result.crop }}</strong>
                is the most suitable crop for your field.
              </p>

              <!-- Confidence bar -->
              <div class="mb-3">
                <div class="d-flex justify-content-between small mb-1">
                  <span class="text-muted">Model Confidence</span>
                  <strong class="text-green">{{ result.confidence }}%</strong>
                </div>
                <div class="progress" style="height: 8px;">
                  <div class="progress-bar bg-success" role="progressbar"
                       style="width: {{ result.confidence }}%"
                       aria-valuenow="{{ result.confidence }}" aria-valuemin="0" aria-valuemax="100">
                  </div>
                </div>
              </div>

              <!-- Top 3 alternatives -->
              {% if result.top3 and result.top3|length > 1 %}
              <div class="mt-2">
                <p class="small text-muted mb-2"><i class="bi bi-bar-chart-fill me-1 text-green"></i><strong>Top Alternatives</strong></p>
                <div class="d-flex flex-wrap gap-2">
                  {% for crop_name, prob in result.top3[1:] %}
                  <span class="badge rounded-pill px-3 py-2"
                        style="background:#e8f5e9; color:#2e7d32; font-size:0.8rem;">
                    {{ crop_name }} — {{ prob }}%
                  </span>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
            </div>
          </div>
          {% endif %}

          {% if error %}
          <div class="alert alert-danger mt-4">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ error }}
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Info sidebar -->
      <div class="col-lg-5">
        <!-- How it works -->
        <div class="info-card mb-4" data-aos="fade-up" data-aos-delay="100">
          <h5 class="info-card-title"><i class="bi bi-info-circle-fill me-2 text-green"></i>How It Works</h5>
          <ol class="info-list">
            <li>Collect soil nutrient data using a soil test kit.</li>
            <li>Note your local temperature, humidity, and annual rainfall.</li>
            <li>Enter the values in the form and click Predict.</li>
            <li>Our ML model (Random Forest) analyses 7 features.</li>
            <li>Get an instant crop recommendation from 22 possible crops.</li>
          </ol>
        </div>

        <!-- Supported crops -->
        <div class="info-card mb-4" data-aos="fade-up" data-aos-delay="200">
          <h5 class="info-card-title"><i class="bi bi-grid-fill me-2 text-green"></i>22 Supported Crops</h5>
          <div class="d-flex flex-wrap gap-2 mt-2">
            {% for crop in ["Rice","Maize","Chickpea","Kidney Beans","Pigeon Peas","Moth Beans","Mung Bean","Blackgram","Lentil","Pomegranate","Banana","Mango","Grapes","Watermelon","Muskmelon","Apple","Orange","Papaya","Coconut","Cotton","Jute","Coffee"] %}
            <span class="crop-chip">{{ crop }}</span>
            {% endfor %}
          </div>
        </div>

        <!-- Tips -->
        <div class="info-card" data-aos="fade-up" data-aos-delay="300">
          <h5 class="info-card-title"><i class="bi bi-lightbulb-fill me-2 text-green"></i>Pro Tips</h5>
          <ul class="info-tips">
            <li>Test soil from multiple spots and average the values.</li>
            <li>Use weather station data for temperature &amp; rainfall.</li>
            <li>Optimal pH usually lies between 5.5 – 7.0.</li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</section>

{% endblock %}
